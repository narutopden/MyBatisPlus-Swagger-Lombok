package com.topdent.swl.demo;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;
import com.baomidou.mybatisplus.generator.AutoGenerator;
import com.baomidou.mybatisplus.generator.config.DataSourceConfig;
import com.baomidou.mybatisplus.generator.config.GlobalConfig;
import com.baomidou.mybatisplus.generator.config.PackageConfig;
import com.baomidou.mybatisplus.generator.config.StrategyConfig;
import com.baomidou.mybatisplus.generator.config.rules.DateType;
import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;
import org.apache.commons.lang3.StringUtils;

import java.util.Scanner;

/**
 * @author Blue_Sky 7/28/21
 */
public class MyBatisPlusGenerator {

    public static void main(String[] args) {
        //1. å…¨å±€é…ç½®
        GlobalConfig config = new GlobalConfig();
        // æ˜¯å¦æ”¯æŒARæ¨¡å¼
        config.setActiveRecord(true)
                // ä½œè€…
                .setAuthor("blue sky")
                // ç”Ÿæˆè·¯å¾„ï¼Œæœ€å¥½ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œwindowè·¯å¾„æ˜¯ä¸ä¸€æ ·çš„
                //TODO  TODO  TODO  TODO
                .setOutputDir("/Users/itachi/Desktop/demo-springboot/AutoGenerated/src/main/java")
                // æ–‡ä»¶è¦†ç›–
                .setFileOverride(true)
                // ä¸»é”®ç­–ç•¥
                .setIdType(IdType.AUTO)

                .setDateType(DateType.ONLY_DATE)
                // è®¾ç½®ç”Ÿæˆçš„serviceæ¥å£çš„åå­—çš„é¦–å­—æ¯æ˜¯å¦ä¸ºIï¼Œé»˜è®¤Serviceæ˜¯ä»¥Iå¼€å¤´çš„
                .setServiceName("%sService")

        //å®ä½“ç±»ç»“å°¾åç§°
                .setEntityName("%s")

        //ç”ŸæˆåŸºæœ¬çš„resultMap
                .setBaseResultMap(true)

        //ä¸ä½¿ç”¨ARæ¨¡å¼
                .setActiveRecord(false)

        //ç”ŸæˆåŸºæœ¬çš„SQLç‰‡æ®µ
                .setBaseColumnList(true);

        //2. æ•°æ®æºé…ç½®
        DataSourceConfig dsConfig = new DataSourceConfig();
        // è®¾ç½®æ•°æ®åº“ç±»å‹
        dsConfig.setDbType(DbType.MYSQL)
                .setDriverName("com.mysql.cj.jdbc.Driver")
                //TODO  TODO  TODO  TODO
                .setUrl("jdbc:mysql://127.0.0.1:3306/mls_db?useSSL=false")
                .setUsername("root")
                .setPassword("root");

        //3. ç­–ç•¥é…ç½®globalConfigurationä¸­
        StrategyConfig stConfig = new StrategyConfig();

        //å…¨å±€å¤§å†™å‘½å
        stConfig.setCapitalMode(true)
                // æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥
                .setNaming(NamingStrategy.underline_to_camel)

        //ä½¿ç”¨lombok
                .setEntityLombokModel(true)

        //ä½¿ç”¨restcontrolleræ³¨è§£
                .setRestControllerStyle(true)

        // ç”Ÿæˆçš„è¡¨, æ”¯æŒå¤šè¡¨ä¸€èµ·ç”Ÿæˆï¼Œä»¥æ•°ç»„å½¢å¼å¡«å†™
        //TODO  TODO  TODO  TODO ä¸¤ä¸ªæ–¹å¼ï¼Œç›´æ¥å†™ï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œè¾“å…¥
        .setInclude("address","product","coupon","product_order_item","product_order","user");
        //.setInclude(scanner("è¡¨åï¼Œå¤šä¸ªè‹±æ–‡é€—å·åˆ†å‰²").split(","));

        //4. åŒ…åç­–ç•¥é…ç½®
        PackageConfig pkConfig = new PackageConfig();
        pkConfig.setParent("com.topdent.swl.demo")
                .setMapper("mapper")
                .setService("service")
                .setController("controller")
                .setEntity("model")
                .setXml("mapper");

        //5. æ•´åˆé…ç½®
        AutoGenerator ag = new AutoGenerator();
        ag.setGlobalConfig(config)
                .setDataSource(dsConfig)
                .setStrategy(stConfig)
                .setPackageInfo(pkConfig);

        //6. æ‰§è¡Œæ“ä½œ
        ag.execute();
        System.out.println("======= BLUE SKY ğŸŒŠ Done ç›¸å…³ä»£ç ç”Ÿæˆå®Œæ¯•  ========");
    }

    /**
     * <p>
     * è¯»å–æ§åˆ¶å°å†…å®¹
     * </p>
     */
    public static String scanner(String tip) {
        Scanner scanner = new Scanner(System.in);
        StringBuilder help = new StringBuilder();
        help.append("è¯·è¾“å…¥" + tip + "ï¼š");
        System.out.println(help.toString());
        if (scanner.hasNext()) {
            String ipt = scanner.next();
            if (StringUtils.isNotBlank(ipt)) {
                return ipt;
            }
        }
        throw new MybatisPlusException("è¯·è¾“å…¥æ­£ç¡®çš„" + tip + "ï¼");
    }
}
